<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Minha Lista de Tarefas</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
      /* Estilos gerais... (iguais aos de antes) */
      body { font-family: sans-serif; padding: 2em; background-color: #f0f2f5; color: #1c1e21; display: flex; justify-content: center; }
      .app-container { background-color: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); width: 100%; max-width: 500px; }
      input { width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
      .py-button { width: 100%; padding: 10px 15px; border: none; background-color: #007bff; color: white; font-size: 16px; font-weight: bold; border-radius: 6px; cursor: pointer; margin-top: 10px; transition: background-color 0.2s; }
      .py-button:hover { background-color: #0056b3; }
      ul { list-style-type: none; padding-left: 0; }
      
      /* MUDANÇA: Estilo para cada item da lista para alinhar o texto e o botão */
      li {
        display: flex;
        justify-content: space-between; /* Alinha o texto na esquerda e o botão na direita */
        align-items: center;
        background-color: #f9f9f9;
        padding: 10px;
        border-bottom: 1px solid #eee;
      }
      li:first-child { border-top-left-radius: 6px; border-top-right-radius: 6px; }
      li:last-child { border-bottom: none; border-bottom-left-radius: 6px; border-bottom-right-radius: 6px; }

      /* NOVO: Estilo para o nosso botão de excluir */
      .delete-button {
        background-color: #dc3545; /* Vermelho perigo */
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
      }
      .delete-button:hover {
        background-color: #c82333; /* Vermelho mais escuro */
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <h1>Minha Lista de Tarefas</h1>
      <label for="tarefa_input">Nova tarefa:</label><br>
      <input id="tarefa_input" type="text" placeholder="Ex: Aprender a excluir itens">
      <button py-click="adicionar_tarefa" class="py-button">Adicionar Tarefa</button>
      <hr>
      <h2>Tarefas a fazer:</h2>
      <div id="lista_de_tarefas"></div>
    </div>

    <py-script>
      from pyscript import display
      from js import document, localStorage
      import json

      tarefas = []

      def renderizar_lista():
        html_da_lista = "<ul>"
        # MUDANÇA: Usamos 'enumerate' para ter acesso ao índice (i) de cada tarefa
        for i, tarefa in enumerate(tarefas):
          # MUDANÇA: Adicionamos um botão com a classe 'delete-button' e o 'value' dele será o índice 'i'.
          # Todos os botões chamarão a mesma função 'remover_tarefa'.
          html_da_lista += f'<li>{tarefa} <button class="delete-button" py-click="remover_tarefa" value="{i}">X</button></li>'
        html_da_lista += "</ul>"
        display(html_da_lista, target="lista_de_tarefas", append=False)

      # NOVO: A função que será chamada pelos botões de excluir
      def remover_tarefa(event):
        # O 'event.target' é o elemento exato que foi clicado (o botão 'X').
        # Pegamos o 'value' dele, que definimos como sendo o índice da tarefa.
        # Convertemos para inteiro, pois ele vem como texto.
        indice_para_remover = int(event.target.value)
        
        # Remove a tarefa da lista Python usando o índice
        tarefas.pop(indice_para_remover)
        
        # Salva a nova lista (sem o item removido) e redesenha a tela
        salvar_tarefas()
        renderizar_lista()

      def adicionar_tarefa():
        input_tarefa = document.getElementById("tarefa_input")
        nova_tarefa = input_tarefa.value
        if nova_tarefa:
          tarefas.append(nova_tarefa)
          input_tarefa.value = ""
          renderizar_lista()
          salvar_tarefas()

      def salvar_tarefas():
        localStorage.setItem("minhas_tarefas", json.dumps(tarefas))

      def carregar_tarefas():
        tarefas_salvas_texto = localStorage.getItem("minhas_tarefas")
        if tarefas_salvas_texto:
          tarefas.extend(json.loads(tarefas_salvas_texto))
          renderizar_lista()

      carregar_tarefas()
    </py-script>
  </body>
</html>
